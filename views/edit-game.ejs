<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<main>
    <h1>Editing <%= game.name %></h1>
    <% if(error) { %>
        <div class="form-error">
            <%= error %>
        </div>
    <% } %>
    <a href="/games/<%= game.slug %>">Back to game page</a>
    <a href="/games/<%= game.slug %>/times">Add times for this game</a>
    <form action="/games/<%= game.slug %>/edit" method="post">
        <div>
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required value="<%= game.name %>" />
        </div>
        <div>
            <label for="summary">Summary</label>
            <p>This appears as a short description of the game - aim for 10 words or fewer.</p>
            <input type="text" id="summary" name="summary" value="<%= game.summary %>" />
        </div>
        <div>
            <label for="description">Description</label>
            <p>This appears as a longer description of the game. Markdown is allowed.</p>
            <textarea class="mde" id="description" name="description" value="<%= game.description %>"></textarea>
        </div>
        <div>
            <label for="content_warnings">Content warnings</label>
            <p>What should players be aware of before joining this game?</p>
            <noscript>
                You should enable Javascript to input content warnings (multiple-select is not very good in HTML alone).
                <br />
                <details>
                    <summary>Full list of options</summary>
                    <ul>
                        <% allowedContentWarnings.forEach(cw => {%>
                            <li><%= cw %></li>
                        <% }) %>
                    </ul>
                </details>
                Separate each option with a comma.
            </noscript>
            <select class="multiselect" name="content_warnings[]" multiple>
                <% allowedContentWarnings.forEach(cw => {%>
                    <option value="<%= cw %>"><%= cw %></option>
                <% }) %>
            </select>
        </div>
        <div>
            <label for="custom_content_warning">Other content warnings</label>
            <p>Anything not covered by the selector above.</p>
            <input type="text" id="custom_contentWarning" name="custom_content_warning" value="<%= game.custom_content_warnings %>" />
        </div>
        <div>
            <label for="min_players">Minimum players</label>
            <input type="number" id="min_players" name="min_players" value="<%= game.min_players %>" />
        </div>
        <div>
            <label for="max_players">Maximum players</label>
            <input type="number" id="max_players" name="max_players" value="<%= game.max_players %>" />
        </div>
        <input type="submit" value="Save changes" />
    </form>
</main>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const simplemde = new SimpleMDE({
            element: document.querySelector('textarea.mde'),
            spellChecker: false,
            status: false,
            toolbar: [
                'bold', 'italic', 'heading', '|',
                'quote', 'unordered-list', 'ordered-list', '|',
                'link', 'image', 'table', '|',
                'preview', 'side-by-side', 'fullscreen'
            ]
        });
        $('.multiselect').select2()
    });
</script>